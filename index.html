<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡Œææ¸…å–®</title>
    <style>
        /* æ¨£å¼ä¿æŒå®Œå…¨ä¸è®Š */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #17a2b8; --primary-dark: #138496; --bg: #f5f5f5; --card-bg: white; --text: #333; --border: #ddd; --danger: #dc3545; --success: #28a745; }
        body.theme-teal { --primary: #88b5b0; --primary-dark: #729d98; }
        body.theme-blue { --primary: #9ba8c7; --primary-dark: #8392b3; }
        body.theme-red { --primary: #d5a6a6; --primary-dark: #c18f8f; }
        body.theme-orange { --primary: #d9b08c; --primary-dark: #c59d77; }
        body.theme-purple { --primary: #b8a9c9; --primary-dark: #a392b5; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans TC', sans-serif; background: var(--bg); padding-bottom: 80px; }
        .header { background: var(--primary); color: white; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 20px; flex: 1; cursor: pointer; }
        .header-icons { display: flex; gap: 12px; }
        .icon-btn { width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.2); border: none; color: white; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.2s; }
        .icon-btn:active { background: rgba(255,255,255,0.3); }
        .search-bar { background: white; padding: 12px 16px; display: flex; gap: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); flex-direction: column; }
        .search-row { display: flex; gap: 8px; align-items: stretch; }
        .search-input { flex: 1; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; }
        .category-select { min-width: 120px; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; background: white; }
        .filter-checkbox { display: flex; align-items: center; gap: 8px; font-size: 14px; color: #666; cursor: pointer; user-select: none; }
        .filter-checkbox input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
        .add-btn { padding: 12px 24px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; white-space: nowrap; }
        .category { margin: 16px; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .category-header { padding: 16px; background: var(--card-bg); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .category-title { font-weight: bold; font-size: 16px; flex: 1; }
        .category-count { color: #666; font-size: 14px; margin-right: 8px; }
        .category-actions { display: flex; gap: 8px; }
        .item { padding: 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 12px; }
        .item:last-child { border-bottom: none; }
        .checkbox { width: 24px; height: 24px; border: 2px solid var(--border); border-radius: 6px; cursor: pointer; flex-shrink: 0; position: relative; }
        .checkbox.checked { background: var(--primary); border-color: var(--primary); }
        .checkbox.checked::after { content: 'âœ“'; color: white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 16px; }
        .item-content { flex: 1; display: flex; align-items: center; gap: 12px; }
        .item-text { flex: 1; font-size: 15px; }
        .item-text.completed { text-decoration: line-through; color: #999; }
        .item-category { padding: 4px 12px; background: var(--bg); border-radius: 12px; font-size: 13px; color: #666; }
        .item-actions { display: flex; gap: 8px; }
        .btn-icon { width: 36px; height: 36px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .btn-edit { background: var(--primary); color: white; }
        .btn-delete { background: var(--danger); color: white; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: white; border-radius: 16px; padding: 24px; max-width: 500px; width: 100%; max-height: 80vh; overflow-y: auto; }
        .modal-title { font-size: 20px; font-weight: bold; margin-bottom: 20px; }
        .modal-subtitle { font-size: 14px; color: #666; margin-bottom: 16px; }
        .form-group { margin-bottom: 16px; }
        .form-input { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; }
        .form-select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; }
        .modal-buttons { display: flex; gap: 12px; margin-top: 24px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 14px; font-weight: bold; cursor: pointer; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .theme-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px; }
        .theme-option { padding: 20px; border-radius: 12px; text-align: center; color: white; font-weight: bold; cursor: pointer; position: relative; transition: transform 0.2s; }
        .theme-option:active { transform: scale(0.95); }
        .theme-option.selected::after { content: 'âœ“'; position: absolute; bottom: 8px; right: 8px; font-size: 24px; }
        .theme-teal { background: #88b5b0; }
        .theme-blue { background: #9ba8c7; }
        .theme-red { background: #d5a6a6; }
        .theme-orange { background: #d9b08c; }
        .theme-purple { background: #b8a9c9; }
        .trash-container { margin-top: 16px; }
        .trash-item { padding: 12px; background: var(--bg); border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .btn-restore { padding: 6px 12px; background: var(--success); color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer; }
        .btn-danger { background: var(--danger); color: white; }
        .trash-count { background: var(--danger); color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; position: absolute; top: -4px; right: -4px; }
        .category-list { margin-top: 16px; }
        .category-item { padding: 12px; background: var(--bg); border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .category-item-actions { display: flex; gap: 8px; }
        .btn-move { background: transparent; border: none; font-size: 20px; cursor: pointer; color: #666; }
        .empty-state { text-align: center; padding: 40px 20px; color: #999; }
    </style>
</head>
<body class="theme-teal">
    <div class="header">
        <h1 id="appTitle" onclick="editTitle()">é»ƒåˆ€é®æ¥µå…‰æ‰“åŒ…æ¸…å–®</h1>
        <div class="header-icons">
            <button class="icon-btn" onclick="openThemeModal()" title="ä¸»é¡Œ">ğŸ¨</button>
            <button class="icon-btn" onclick="openCategoryModal()" title="åˆ†é¡ç®¡ç†">â‰¡</button>
            <button class="icon-btn" onclick="openTrashModal()" style="position: relative;" title="åƒåœ¾æ¡¶">
                ğŸ—‘ï¸
                <span class="trash-count" id="trashCount" style="display: none;">0</span>
            </button>
        </div>
    </div>

    <div class="search-bar">
        <div class="search-row">
            <input type="text" class="search-input" id="quickAddInput" placeholder="è¼¸å…¥è¦æ‰“åŒ…çš„è¥ªå¥—/æ”å½±ç‰©å“...">
            <select class="category-select" id="quickAddCategory"></select>
            <button class="add-btn" onclick="quickAddItem()">æ–°å¢é …ç›®</button>
        </div>
        <label class="filter-checkbox">
            <input type="checkbox" id="showUnpackedOnly" onchange="render()">
            åƒ…é¡¯ç¤ºæœªæ‰“åŒ…
        </label>
    </div>

    <div id="categoriesContainer"></div>

    <div class="modal" id="itemModal">
        <div class="modal-content">
            <div class="modal-title" id="itemModalTitle">æ–°å¢é …ç›®</div>
            <div class="form-group">
                <input type="text" class="form-input" id="itemName" placeholder="é …ç›®åç¨±">
            </div>
            <div class="form-group">
                <select class="form-select" id="itemCategory"></select>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeItemModal()">é—œé–‰</button>
                <button class="btn btn-primary" onclick="saveItem()">å„²å­˜</button>
            </div>
        </div>
    </div>

    <div class="modal" id="themeModal">
        <div class="modal-content">
            <div class="modal-title">é¸æ“‡æ‡‰ç”¨ç¨‹å¼ä¸»é¡Œè‰²</div>
            <div class="modal-subtitle">é€™å°‡æ›´æ”¹æŒ‰éˆ•ã€é‚Šæ¡†å’Œä¸»è¦è¦–è¦ºå…ƒç´ çš„é¡è‰²ã€‚</div>
            <div class="theme-grid">
                <div class="theme-option theme-teal" onclick="setTheme('teal')">æ¹–æ°´ç¶ </div>
                <div class="theme-option theme-blue" onclick="setTheme('blue')">æ˜Ÿç©ºè—</div>
                <div class="theme-option theme-red" onclick="setTheme('red')">æ¥µå…‰ç´…</div>
                <div class="theme-option theme-orange" onclick="setTheme('orange')">ç¥ç€é»ƒ</div>
                <div class="theme-option theme-purple" onclick="setTheme('purple')">å¤¢å¹»ç´«</div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeThemeModal()">é—œé–‰</button>
            </div>
        </div>
    </div>

    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-title">ç®¡ç†åˆ†é¡èˆ‡é †åº</div>
            <div class="category-list" id="categoryList"></div>
            <div class="form-group" style="margin-top: 20px;">
                <input type="text" class="form-input" id="newCategoryName" placeholder="æ–°å¢åˆ†é¡åç¨±">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeCategoryModal()">é—œé–‰</button>
                <button class="btn btn-primary" onclick="addCategory()">æ–°å¢</button>
            </div>
        </div>
    </div>

    <div class="modal" id="trashModal">
        <div class="modal-content">
            <div class="modal-title">æ¸…å–®å·¥å…·ç®±</div>
            <div class="trash-container" id="trashContainer"></div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeTrashModal()">é—œé–‰</button>
                <button class="btn btn-danger" onclick="emptyTrash()">å®Œå…¨é‡ç½®æ¸…å–® (å±éšª)</button>
            </div>
        </div>
    </div>

    <script>
        // è¨­å®šé»ƒåˆ€é®æ¥µå…‰æ—…è¡Œçš„é è¨­è³‡æ–™
        const DEFAULT_DATA = {
            title: 'é»ƒåˆ€é®æ¥µå…‰æ‰“åŒ…æ¸…å–®',
            theme: 'teal',
            categories: ['æ¥µåœ°ç¦¦å¯’è¡£ç‰©', 'æ”å½±èˆ‡é›»å­è¨­å‚™', 'æš–æš–åŒ…èˆ‡éš¨èº«ä¿æš–', 'é‡è¦æ–‡ä»¶èˆ‡ç¾é‡‘', 'ç›¥æ´—èˆ‡æ¥µè‡´ä¿æ¿•'],
            items: [
                // æ¥µåœ°ç¦¦å¯’è¡£ç‰©
                { id: 1, name: 'æ¥µåœ°ç¾½çµ¨å¤–å¥— (Canada Goose/ç§Ÿå€Ÿç­‰ç´š)', category: 'æ¥µåœ°ç¦¦å¯’è¡£ç‰©', completed: false },
                { id: 2, name: 'é˜²æ°´é˜²é¢¨æ»‘é›ªè¤² (é›ªåœ°å¿…å‚™)', category: 'æ¥µåœ°ç¦¦å¯’è¡£ç‰©', completed: false },
                { id: 3, name: 'ç¾éº—è«¾ç¾Šæ¯›ç™¼ç†±è¡£è¤² (åº•å±¤ x3å¥—)', category: 'æ¥µåœ°ç¦¦å¯’è¡£ç‰©', completed: false },
                { id: 4, name: 'æŠ“çµ¨è¡£/ç¾Šæ¯›è¡£ (ä¸­å±¤ä¿æš–)', category: 'æ¥µåœ°ç¦¦å¯’è¡£ç‰©', completed: false },
                { id: 5, name: 'ç¾Šæ¯›è¥ª (åšåº•ä¿æš–æ¬¾ x5é›™)', category: 'æ¥µåœ°ç¦¦å¯’è¡£ç‰©', completed: false },
                { id: 6, name: 'é˜²å¯’é›ªé´ (Sorel/Kamik -30Â°Cç­‰ç´š)', category: 'æ¥µåœ°ç¦¦å¯’è¡£ç‰©', completed: false },
                { id: 7, name: 'å…©æˆªå¼æ‰‹å¥— (å…§è§¸æ§+å¤–é˜²é¢¨)', category: 'æ¥µåœ°ç¦¦å¯’è¡£ç‰©', completed: false },
                { id: 8, name: 'é®è€³æ¯›å¸½ (ä¿è­·é ­éƒ¨)', category: 'æ¥µåœ°ç¦¦å¯’è¡£ç‰©', completed: false },
                { id: 9, name: 'åœè„–/é˜²é¢¨é¢ç½© (é˜²æ­¢è‡‰å‡å‚·)', category: 'æ¥µåœ°ç¦¦å¯’è¡£ç‰©', completed: false },
                
                // æ”å½±èˆ‡é›»å­è¨­å‚™
                { id: 10, name: 'ç›¸æ©Ÿ + å¤§å…‰åœˆå»£è§’é¡', category: 'æ”å½±èˆ‡é›»å­è¨­å‚™', completed: false },
                { id: 11, name: 'ç©©å›ºè…³æ¶ (æ‹æ”æ¥µå…‰é•·æ›å¿…å‚™)', category: 'æ”å½±èˆ‡é›»å­è¨­å‚™', completed: false },
                { id: 12, name: 'ç›¸æ©Ÿå‚™ç”¨é›»æ±  x3 (ä½æº«è€—é›»å¿«)', category: 'æ”å½±èˆ‡é›»å­è¨­å‚™', completed: false },
                { id: 13, name: 'å¿«é–€ç·š (é˜²æ­¢æ‰‹éœ‡)', category: 'æ”å½±èˆ‡é›»å­è¨­å‚™', completed: false },
                { id: 14, name: 'é¡é ­é™¤éœ§ç™¼ç†±å¸¶', category: 'æ”å½±èˆ‡é›»å­è¨­å‚™', completed: false },
                { id: 15, name: 'å¤§å®¹é‡è¡Œå‹•é›»æº', category: 'æ”å½±èˆ‡é›»å­è¨­å‚™', completed: false },
                { id: 16, name: 'ç¾åŠ é€šç”¨è½‰æ¥é ­ (110Væ‰æ’)', category: 'æ”å½±èˆ‡é›»å­è¨­å‚™', completed: false },

                // æš–æš–åŒ…èˆ‡éš¨èº«ä¿æš–
                { id: 17, name: 'è²¼å¼æš–æš–åŒ… (è²¼èº«é«”)', category: 'æš–æš–åŒ…èˆ‡éš¨èº«ä¿æš–', completed: false },
                { id: 18, name: 'è¶³è²¼æš–æš–åŒ… (è²¼è…³åº•è¶…é‡è¦)', category: 'æš–æš–åŒ…èˆ‡éš¨èº«ä¿æš–', completed: false },
                { id: 19, name: 'æ‰‹æ¡å¼æš–æš–åŒ… (æ”¾å£è¢‹æš–æ‰‹)', category: 'æš–æš–åŒ…èˆ‡éš¨èº«ä¿æš–', completed: false },
                { id: 20, name: 'ä¿æº«ç“¶ (è£ç†±æ°´éš¨æ™‚å–)', category: 'æš–æš–åŒ…èˆ‡éš¨èº«ä¿æš–', completed: false },
                { id: 21, name: 'å¢¨é¡ (ç™½å¤©é›ªåœ°åå…‰å¼·)', category: 'æš–æš–åŒ…èˆ‡éš¨èº«ä¿æš–', completed: false },

                // é‡è¦æ–‡ä»¶èˆ‡ç¾é‡‘
                { id: 22, name: 'è­·ç…§ + eTAç°½è­‰åˆ—å°æœ¬', category: 'é‡è¦æ–‡ä»¶èˆ‡ç¾é‡‘', completed: false },
                { id: 23, name: 'æ¥µå…‰åœ˜/é£¯åº—é è¨‚æ†‘è­‰', category: 'é‡è¦æ–‡ä»¶èˆ‡ç¾é‡‘', completed: false },
                { id: 24, name: 'æ—…éŠä¿éšªå–® (å«æµ·å¤–é†«ç™‚)', category: 'é‡è¦æ–‡ä»¶èˆ‡ç¾é‡‘', completed: false },
                { id: 25, name: 'ä¿¡ç”¨å¡ + å°‘é‡åŠ å¹£ç¾é‡‘', category: 'é‡è¦æ–‡ä»¶èˆ‡ç¾é‡‘', completed: false },

                // ç›¥æ´—èˆ‡æ¥µè‡´ä¿æ¿•
                { id: 26, name: 'é«˜ä¿æ¿•èº«é«”ä¹³/é¢éœœ (æ¥µä¹¾ç‡¥)', category: 'ç›¥æ´—èˆ‡æ¥µè‡´ä¿æ¿•', completed: false },
                { id: 27, name: 'è­·å”‡è† + è­·æ‰‹éœœ', category: 'ç›¥æ´—èˆ‡æ¥µè‡´ä¿æ¿•', completed: false },
                { id: 28, name: 'ç‰™åˆ·ç‰™è† (ç’°ä¿ä¸æä¾›)', category: 'ç›¥æ´—èˆ‡æ¥µè‡´ä¿æ¿•', completed: false },
                { id: 29, name: 'æ‹–é‹ (é£¯åº—é€šå¸¸æ²’æœ‰)', category: 'ç›¥æ´—èˆ‡æ¥µè‡´ä¿æ¿•', completed: false }
            ]
        };

        let data = {
            title: DEFAULT_DATA.title,
            theme: DEFAULT_DATA.theme,
            categories: [...DEFAULT_DATA.categories],
            items: [],
            trash: [],
            currentEditId: null
        };

        function loadData() {
            const saved = localStorage.getItem('packingListData');
            if (saved) {
                data = JSON.parse(saved);
                document.getElementById('appTitle').textContent = data.title;
                document.body.className = `theme-${data.theme}`;
            } else {
                // Initialize with default data
                data.items = [...DEFAULT_DATA.items];
                // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¼‰å…¥ï¼Œç¢ºä¿åˆ†é¡ä¹Ÿä½¿ç”¨é è¨­çš„
                if(data.categories.length === 5 && data.categories[0] === 'ç¦¦å¯’è¡£ç‰©') {
                     // èˆŠçš„é è¨­å€¼ï¼Œè¦†è“‹ç‚ºæ–°çš„
                     data.categories = [...DEFAULT_DATA.categories];
                     data.title = DEFAULT_DATA.title;
                }
            }
            updateQuickAddCategorySelect();
            render();
        }

        function saveData() {
            localStorage.setItem('packingListData', JSON.stringify(data));
            updateTrashCount();
        }

        function render() {
            const container = document.getElementById('categoriesContainer');
            const showUnpackedOnly = document.getElementById('showUnpackedOnly').checked;
            
            container.innerHTML = '';
            
            data.categories.forEach(category => {
                let categoryItems = data.items.filter(item => item.category === category);
                
                if (showUnpackedOnly) {
                    categoryItems = categoryItems.filter(item => !item.completed);
                }
                
                if (categoryItems.length === 0) return;
                
                const completed = categoryItems.filter(item => item.completed).length;
                const total = categoryItems.length;
                
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                categoryDiv.innerHTML = `
                    <div class="category-header">
                        <div class="category-title">${category}</div>
                        <div class="category-count">(${completed} é …æœªæ‰“åŒ… / ${total} é …ç¸½è¨ˆ)</div>
                    </div>
                    ${categoryItems.map(item => `
                        <div class="item">
                            <div class="checkbox ${item.completed ? 'checked' : ''}" onclick="toggleItem(${item.id})"></div>
                            <div class="item-content">
                                <div class="item-text ${item.completed ? 'completed' : ''}">${item.name}</div>
                                <div class="item-category">${item.category}</div>
                            </div>
                            <div class="item-actions">
                                <button class="btn-icon btn-edit" onclick="editItem(${item.id})">âœï¸</button>
                                <button class="btn-icon btn-delete" onclick="deleteItem(${item.id})">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    `).join('')}
                `;
                
                container.appendChild(categoryDiv);
            });

            if (container.children.length === 0) {
                container.innerHTML = '<div class="empty-state">æ²’æœ‰é …ç›®</div>';
            }
        }

        function toggleItem(id) {
            const item = data.items.find(i => i.id === id);
            if (item) {
                item.completed = !item.completed;
                saveData();
                render();
            }
        }

        function quickAddItem() {
            const name = document.getElementById('quickAddInput').value.trim();
            const category = document.getElementById('quickAddCategory').value;
            
            if (!name) {
                alert('è«‹è¼¸å…¥é …ç›®åç¨±');
                return;
            }
            
            const newId = Math.max(0, ...data.items.map(i => i.id)) + 1;
            data.items.push({
                id: newId,
                name: name,
                category: category,
                completed: false
            });
            
            document.getElementById('quickAddInput').value = '';
            saveData();
            render();
        }

        function updateQuickAddCategorySelect() {
            const select = document.getElementById('quickAddCategory');
            select.innerHTML = data.categories.map(cat => 
                `<option value="${cat}">${cat}</option>`
            ).join('');
        }

        function openAddModal() {
            data.currentEditId = null;
            document.getElementById('itemModalTitle').textContent = 'æ–°å¢é …ç›®';
            document.getElementById('itemName').value = '';
            updateCategorySelect();
            document.getElementById('itemModal').classList.add('show');
        }

        function editItem(id) {
            data.currentEditId = id;
            const item = data.items.find(i => i.id === id);
            if (item) {
                document.getElementById('itemModalTitle').textContent = 'ç·¨è¼¯é …ç›®';
                document.getElementById('itemName').value = item.name;
                updateCategorySelect();
                document.getElementById('itemCategory').value = item.category;
                document.getElementById('itemModal').classList.add('show');
            }
        }

        function closeItemModal() {
            document.getElementById('itemModal').classList.remove('show');
        }

        function saveItem() {
            const name = document.getElementById('itemName').value.trim();
            const category = document.getElementById('itemCategory').value;
            
            if (!name) {
                alert('è«‹è¼¸å…¥é …ç›®åç¨±');
                return;
            }
            
            if (data.currentEditId) {
                const item = data.items.find(i => i.id === data.currentEditId);
                if (item) {
                    item.name = name;
                    item.category = category;
                }
            } else {
                const newId = Math.max(0, ...data.items.map(i => i.id)) + 1;
                data.items.push({
                    id: newId,
                    name: name,
                    category: category,
                    completed: false
                });
            }
            
            saveData();
            render();
            closeItemModal();
        }

        function deleteItem(id) {
            const item = data.items.find(i => i.id === id);
            if (item) {
                data.trash.push({...item, deletedAt: Date.now()});
                data.items = data.items.filter(i => i.id !== id);
                saveData();
                render();
            }
        }

        function updateCategorySelect() {
            const select = document.getElementById('itemCategory');
            select.innerHTML = data.categories.map(cat => 
                `<option value="${cat}">${cat}</option>`
            ).join('');
        }

        function openThemeModal() {
            document.getElementById('themeModal').classList.add('show');
            updateThemeSelection();
        }

        function closeThemeModal() {
            document.getElementById('themeModal').classList.remove('show');
        }

        function setTheme(theme) {
            data.theme = theme;
            document.body.className = `theme-${theme}`;
            saveData();
            updateThemeSelection();
        }

        function updateThemeSelection() {
            document.querySelectorAll('.theme-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelector(`.theme-option.theme-${data.theme}`).classList.add('selected');
        }

        function openCategoryModal() {
            document.getElementById('categoryModal').classList.add('show');
            renderCategoryList();
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.remove('show');
        }

        function renderCategoryList() {
            const list = document.getElementById('categoryList');
            list.innerHTML = data.categories.map((cat, index) => `
                <div class="category-item">
                    <div>${cat}</div>
                    <div class="category-item-actions">
                        ${index > 0 ? `<button class="btn-move" onclick="moveCategoryUp(${index})">â†‘</button>` : '<span style="width: 32px;"></span>'}
                        ${index < data.categories.length - 1 ? `<button class="btn-move" onclick="moveCategoryDown(${index})">â†“</button>` : '<span style="width: 32px;"></span>'}
                        <button class="btn-icon btn-delete" style="width: 32px; height: 32px; font-size: 16px;" onclick="deleteCategory(${index})">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        function addCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            if (!name) {
                alert('è«‹è¼¸å…¥åˆ†é¡åç¨±');
                return;
            }
            if (data.categories.includes(name)) {
                alert('åˆ†é¡å·²å­˜åœ¨');
                return;
            }
            data.categories.push(name);
            document.getElementById('newCategoryName').value = '';
            saveData();
            renderCategoryList();
            updateQuickAddCategorySelect();
            render();
        }

        function deleteCategory(index) {
            const category = data.categories[index];
            const hasItems = data.items.some(item => item.category === category);
            
            if (hasItems) {
                alert('æ­¤åˆ†é¡ä¸‹é‚„æœ‰é …ç›®ï¼Œç„¡æ³•åˆªé™¤');
                return;
            }
            
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${category}ã€åˆ†é¡ï¼Ÿ`)) {
                data.categories.splice(index, 1);
                saveData();
                renderCategoryList();
                updateQuickAddCategorySelect();
                render();
            }
        }

        function moveCategoryUp(index) {
            if (index > 0) {
                [data.categories[index], data.categories[index - 1]] = 
                [data.categories[index - 1], data.categories[index]];
                saveData();
                renderCategoryList();
                updateQuickAddCategorySelect();
                render();
            }
        }

        function moveCategoryDown(index) {
            if (index < data.categories.length - 1) {
                [data.categories[index], data.categories[index + 1]] = 
                [data.categories[index + 1], data.categories[index]];
                saveData();
                renderCategoryList();
                updateQuickAddCategorySelect();
                render();
            }
        }

        function openTrashModal() {
            document.getElementById('trashModal').classList.add('show');
            renderTrash();
        }

        function closeTrashModal() {
            document.getElementById('trashModal').classList.remove('show');
        }

        function renderTrash() {
            const container = document.getElementById('trashContainer');
            if (data.trash.length === 0) {
                container.innerHTML = '<div class="empty-state">åƒåœ¾æ¡¶æ˜¯ç©ºçš„</div>';
                return;
            }
            
            container.innerHTML = data.trash.map((item, index) => `
                <div class="trash-item">
                    <div>
                        <div style="font-weight: bold;">${item.name}</div>
                        <div style="font-size: 12px; color: #666;">${item.category}</div>
                    </div>
                    <button class="btn-restore" onclick="restoreItem(${index})">é‚„åŸ</button>
                </div>
            `).join('');
        }

        function restoreItem(index) {
            const item = data.trash[index];
            data.items.push({
                id: Math.max(0, ...data.items.map(i => i.id)) + 1,
                name: item.name,
                category: item.category,
                completed: item.completed
            });
            data.trash.splice(index, 1);
            saveData();
            renderTrash();
            render();
        }

        function emptyTrash() {
            if (!confirm('âš ï¸ è­¦å‘Šï¼šå®Œå…¨é‡ç½®æ¸…å–®\n\næ­¤æ“ä½œå°‡æœƒï¼š\n\n1. å–æ¶ˆæ‰€æœ‰é …ç›®çš„å‹¾é¸ç‹€æ…‹\n2. åˆªé™¤æ‰€æœ‰æ–°å¢çš„é …ç›®ï¼ˆåªä¿ç•™é è¨­é …ç›®ï¼‰\n3. é‚„åŸæ‰€æœ‰åˆ†é¡è‡³é è¨­ç‹€æ…‹\n4. æ¸…ç©ºå›æ”¶ç«™ä¸­çš„æ‰€æœ‰å…§å®¹\n5. é‚„åŸæ¸…å–®æ¨™é¡Œå’Œä¸»é¡Œé¡è‰²è‡³é è¨­å€¼\n\nâš ï¸ æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼\n\nç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ')) {
                return;
            }
            
            // ç¬¬äºŒæ¬¡ç¢ºèª
            if (!confirm('æœ€å¾Œç¢ºèªï¼šçœŸçš„è¦å°‡æ‰€æœ‰è¨­å®šé‚„åŸåˆ°åˆå§‹ç‹€æ…‹å—ï¼Ÿ')) {
                return;
            }
            
            // å®Œå…¨é‡ç½®åˆ°é è¨­ç‹€æ…‹
            data = {
                title: DEFAULT_DATA.title,
                theme: DEFAULT_DATA.theme,
                categories: [...DEFAULT_DATA.categories],
                items: JSON.parse(JSON.stringify(DEFAULT_DATA.items)), // æ·±æ‹·è²
                trash: [],
                currentEditId: null
            };
            
            // æ›´æ–°UI
            document.getElementById('appTitle').textContent = data.title;
            document.body.className = `theme-${data.theme}`;
            
            saveData();
            closeTrashModal();
            updateQuickAddCategorySelect();
            render();
            alert('âœ… æ¸…å–®å·²å®Œå…¨é‡ç½®è‡³é è¨­ç‹€æ…‹');
        }

        function updateTrashCount() {
            const count = data.trash.length;
            const badge = document.getElementById('trashCount');
            if (count > 0) {
                badge.textContent = count;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function editTitle() {
            const newTitle = prompt('ç·¨è¼¯æ¨™é¡Œï¼š', data.title);
            if (newTitle && newTitle.trim()) {
                data.title = newTitle.trim();
                document.getElementById('appTitle').textContent = data.title;
                saveData();
            }
        }

        // æŒ‰ Enter éµå¿«é€Ÿæ–°å¢é …ç›®
        document.getElementById('quickAddInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                quickAddItem();
            }
        });

        loadData();
    </script>
</body>
</html>

